# Require
require 'mocha'
require 'coffee-script/register'
{ expect } = require 'chai'
{ stdoutTrap, stderrTrap } = require '../logtrap'

# Shorthand
_log = console.log
_err = console.error
_stdout = process.stdout
_stderr = process.stderr

# Some logging function
logger = (type, msg) -> console[type] "#{type}: #{msg}"

# Test
describe 'Traps', ->
  it 'should capture console.log', ->
    expect(stdoutTrap -> _log 'hello world').to.equal 'hello world\n'
  it 'should capture process.stdout.write', ->
    expect(stdoutTrap -> _stdout.write 'hello world').to.equal 'hello world'
  it 'should capture console.err', ->
    expect(stderrTrap -> _err 'err').to.equal 'err\n'
  it 'should capture process.stderr.write', ->
    expect(stderrTrap -> _stderr.write 'err').to.equal 'err'
  it 'should not capture returns', ->
    expect(stdoutTrap -> 'No logging').to.equal ''
  it 'should capture stdout from functions', ->
    expect(stdoutTrap -> logger 'log','hello').to.equal 'log: hello\n'
  it 'should capture stderr from functions', ->
    expect(stderrTrap -> logger 'error','err').to.equal 'error: err\n'



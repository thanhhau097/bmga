var expect, logger, stderrTrap, stdoutTrap, _err, _log, _ref, _stderr, _stdout;

require('mocha');

require('coffee-script/register');

expect = require('chai').expect;

_ref = require('../logtrap'), stdoutTrap = _ref.stdoutTrap, stderrTrap = _ref.stderrTrap;

_log = console.log;

_err = console.error;

_stdout = process.stdout;

_stderr = process.stderr;

logger = function(type, msg) {
  return console[type]("" + type + ": " + msg);
};

describe('Traps', function() {
  it('should capture console.log', function() {
    return expect(stdoutTrap(function() {
      return _log('hello world');
    })).to.equal('hello world\n');
  });
  it('should capture process.stdout.write', function() {
    return expect(stdoutTrap(function() {
      return _stdout.write('hello world');
    })).to.equal('hello world');
  });
  it('should capture console.err', function() {
    return expect(stderrTrap(function() {
      return _err('err');
    })).to.equal('err\n');
  });
  it('should capture process.stderr.write', function() {
    return expect(stderrTrap(function() {
      return _stderr.write('err');
    })).to.equal('err');
  });
  it('should not capture returns', function() {
    return expect(stdoutTrap(function() {
      return 'No logging';
    })).to.equal('');
  });
  it('should capture stdout from functions', function() {
    return expect(stdoutTrap(function() {
      return logger('log', 'hello');
    })).to.equal('log: hello\n');
  });
  return it('should capture stderr from functions', function() {
    return expect(stderrTrap(function() {
      return logger('error', 'err');
    })).to.equal('error: err\n');
  });
});
